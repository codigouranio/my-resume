---
# Deploy all services to a clean/new machine
# Usage: ansible-playbook deploy-new-server.yml --ask-vault-pass --ask-become-pass

- name: "1ï¸âƒ£ Install System Prerequisites"
  import_playbook: playbooks/00-prerequisites.yml

- name: "2ï¸âƒ£ Setup System (Conda, PM2, etc)"
  import_playbook: playbooks/01-system-setup.yml

- name: "3ï¸âƒ£ Setup Database (PostgreSQL + pgvector)"
  import_playbook: playbooks/02-database-setup.yml

- name: "4ï¸âƒ£ Deploy Applications (API + LLM + Frontend)"
  import_playbook: playbooks/03-application-deploy.yml

- name: "5ï¸âƒ£ Configure Nginx Reverse Proxy"
  import_playbook: playbooks/04-nginx-setup.yml

- name: "âœ… Deployment Complete"
  hosts: all
  tasks:
    - name: Display success message
      debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘  ğŸ‰ DEPLOYMENT COMPLETE!                                  â•‘
          â•‘                                                           â•‘
          â•‘  Services Status:                                         â•‘
          â•‘  â€¢ API Service: http://{{ ansible_host }}:3000            â•‘
          â•‘  â€¢ LLM Service: http://{{ ansible_host }}:5000            â•‘
          â•‘  â€¢ Frontend: http://{{ ansible_host }}                    â•‘
          â•‘  â€¢ Database: PostgreSQL on port 5432                      â•‘
          â•‘                                                           â•‘
          â•‘  Next Steps:                                              â•‘
          â•‘  1. Check services: ssh {{ ansible_user }}@{{ ansible_host }} 'pm2 status' â•‘
          â•‘  2. View logs: ssh {{ ansible_user }}@{{ ansible_host }} 'pm2 logs'        â•‘
          â•‘  3. Test API: curl http://{{ ansible_host }}:3000/health  â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
